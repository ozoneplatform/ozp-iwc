<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/js/common/util.js - ozpIwc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="ozpIwc" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.2.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ozpIwc.alert.html">ozpIwc.alert</a></li>
                                <li><a href="../classes/ozpIwc.api.html">ozpIwc.api</a></li>
                                <li><a href="../classes/ozpIwc.api.base.Api.html">ozpIwc.api.base.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.base.Node.html">ozpIwc.api.base.Node</a></li>
                                <li><a href="../classes/ozpIwc.api.data.Api.html">ozpIwc.api.data.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.data.node.Node.html">ozpIwc.api.data.node.Node</a></li>
                                <li><a href="../classes/ozpIwc.api.data.node.Nodev2.html">ozpIwc.api.data.node.Nodev2</a></li>
                                <li><a href="../classes/ozpIwc.api.Endpoint.html">ozpIwc.api.Endpoint</a></li>
                                <li><a href="../classes/ozpIwc.api.EndpointRegistry.html">ozpIwc.api.EndpointRegistry</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadActionError.html">ozpIwc.api.error.BadActionError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadContentError.html">ozpIwc.api.error.BadContentError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadRequestError.html">ozpIwc.api.error.BadRequestError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadResourceError.html">ozpIwc.api.error.BadResourceError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadStateError.html">ozpIwc.api.error.BadStateError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BaseError.html">ozpIwc.api.error.BaseError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.NoActionError.html">ozpIwc.api.error.NoActionError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.NoMatchError.html">ozpIwc.api.error.NoMatchError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.NoPermissionError.html">ozpIwc.api.error.NoPermissionError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.NoResourceError.html">ozpIwc.api.error.NoResourceError</a></li>
                                <li><a href="../classes/ozpIwc.api.filter.base.html">ozpIwc.api.filter.base</a></li>
                                <li><a href="../classes/ozpIwc.api.filter.Function.html">ozpIwc.api.filter.Function</a></li>
                                <li><a href="../classes/ozpIwc.api.filter.standard.html">ozpIwc.api.filter.standard</a></li>
                                <li><a href="../classes/ozpIwc.api.intents.Api.html">ozpIwc.api.intents.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.intents.FSM.html">ozpIwc.api.intents.FSM</a></li>
                                <li><a href="../classes/ozpIwc.api.Lifespan.Bound.html">ozpIwc.api.Lifespan.Bound</a></li>
                                <li><a href="../classes/ozpIwc.api.Lifespan.Ephemeral.html">ozpIwc.api.Lifespan.Ephemeral</a></li>
                                <li><a href="../classes/ozpIwc.api.Lifespan.Persistent.html">ozpIwc.api.Lifespan.Persistent</a></li>
                                <li><a href="../classes/ozpIwc.api.locks.Api.html">ozpIwc.api.locks.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.locks.Node.html">ozpIwc.api.locks.Node</a></li>
                                <li><a href="../classes/ozpIwc.api.names.Api.html">ozpIwc.api.names.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.names.Node.html">ozpIwc.api.names.Node</a></li>
                                <li><a href="../classes/ozpIwc.api.system.Api.html">ozpIwc.api.system.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.ApplicationNode.html">ozpIwc.api.system.node.ApplicationNode</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.ApplicationNodeV2.html">ozpIwc.api.system.node.ApplicationNodeV2</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.SystemNode.html">ozpIwc.api.system.node.SystemNode</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.UserNode.html">ozpIwc.api.system.node.UserNode</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.UserNodeV2.html">ozpIwc.api.system.node.UserNodeV2</a></li>
                                <li><a href="../classes/ozpIwc.apiMap.html">ozpIwc.apiMap</a></li>
                                <li><a href="../classes/ozpIwc.Client.html">ozpIwc.Client</a></li>
                                <li><a href="../classes/ozpIwc.Debugger.html">ozpIwc.Debugger</a></li>
                                <li><a href="../classes/ozpIwc.Lifespan.html">ozpIwc.Lifespan</a></li>
                                <li><a href="../classes/ozpIwc.log.html">ozpIwc.log</a></li>
                                <li><a href="../classes/ozpIwc.metric.Registry.html">ozpIwc.metric.Registry</a></li>
                                <li><a href="../classes/ozpIwc.metric.stats.BinaryHeap.html">ozpIwc.metric.stats.BinaryHeap</a></li>
                                <li><a href="../classes/ozpIwc.metric.stats.ExponentiallyDecayingSample.html">ozpIwc.metric.stats.ExponentiallyDecayingSample</a></li>
                                <li><a href="../classes/ozpIwc.metric.stats.Sample.html">ozpIwc.metric.stats.Sample</a></li>
                                <li><a href="../classes/ozpIwc.metric.stats.UniformSample.html">ozpIwc.metric.stats.UniformSample</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.BaseMetric.html">ozpIwc.metric.types.BaseMetric</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.Counter.html">ozpIwc.metric.types.Counter</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.Gauge.html">ozpIwc.metric.types.Gauge</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.Histogram.html">ozpIwc.metric.types.Histogram</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.Meter.html">ozpIwc.metric.types.Meter</a></li>
                                <li><a href="../classes/ozpIwc.network.KeyBroadcastLocalStorageLink.html">ozpIwc.network.KeyBroadcastLocalStorageLink</a></li>
                                <li><a href="../classes/ozpIwc.network.Peer.html">ozpIwc.network.Peer</a></li>
                                <li><a href="../classes/ozpIwc.packet.Fragment.html">ozpIwc.packet.Fragment</a></li>
                                <li><a href="../classes/ozpIwc.packet.FragmentStore.html">ozpIwc.packet.FragmentStore</a></li>
                                <li><a href="../classes/ozpIwc.packet.Network.html">ozpIwc.packet.Network</a></li>
                                <li><a href="../classes/ozpIwc.packet.Transport.html">ozpIwc.packet.Transport</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.elements.SecurityAttribute.html">ozpIwc.policyAuth.elements.SecurityAttribute</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.points.PDP.html">ozpIwc.policyAuth.points.PDP</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.points.PIP.html">ozpIwc.policyAuth.points.PIP</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.points.PRP.html">ozpIwc.policyAuth.points.PRP</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.points.utils.html">ozpIwc.policyAuth.points.utils</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.policies.html">ozpIwc.policyAuth.policies</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.PolicyCombining.html">ozpIwc.policyAuth.PolicyCombining</a></li>
                                <li><a href="../classes/ozpIwc.Timer.html">ozpIwc.Timer</a></li>
                                <li><a href="../classes/ozpIwc.transport.consensus.Base.html">ozpIwc.transport.consensus.Base</a></li>
                                <li><a href="../classes/ozpIwc.transport.consensus.Bully.html">ozpIwc.transport.consensus.Bully</a></li>
                                <li><a href="../classes/ozpIwc.transport.listener.SharedWorker.html">ozpIwc.transport.listener.SharedWorker</a></li>
                                <li><a href="../classes/ozpIwc.transport.PacketContext.html">ozpIwc.transport.PacketContext</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Base.html">ozpIwc.transport.participant.Base</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Client.html">ozpIwc.transport.participant.Client</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Debugger.html">ozpIwc.transport.participant.Debugger</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Internal.html">ozpIwc.transport.participant.Internal</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Multicast.html">ozpIwc.transport.participant.Multicast</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.MutexClient.html">ozpIwc.transport.participant.MutexClient</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.PostMessage.html">ozpIwc.transport.participant.PostMessage</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.RouterWatchdog.html">ozpIwc.transport.participant.RouterWatchdog</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.SharedWorker.html">ozpIwc.transport.participant.SharedWorker</a></li>
                                <li><a href="../classes/ozpIwc.transport.Router.html">ozpIwc.transport.Router</a></li>
                                <li><a href="../classes/ozpIwc.util.html">ozpIwc.util</a></li>
                                <li><a href="../classes/ozpIwc.util.AjaxPersistenceQueue.html">ozpIwc.util.AjaxPersistenceQueue</a></li>
                                <li><a href="../classes/ozpIwc.util.ApiPromiseMixin.html">ozpIwc.util.ApiPromiseMixin</a></li>
                                <li><a href="../classes/ozpIwc.util.AsyncAction.html">ozpIwc.util.AsyncAction</a></li>
                                <li><a href="../classes/ozpIwc.util.CancelableEvent.html">ozpIwc.util.CancelableEvent</a></li>
                                <li><a href="../classes/ozpIwc.util.Event.html">ozpIwc.util.Event</a></li>
                                <li><a href="../classes/ozpIwc.util.mutex.html">ozpIwc.util.mutex</a></li>
                                <li><a href="../classes/ozpIwc.util.object.html">ozpIwc.util.object</a></li>
                                <li><a href="../classes/ozpIwc.util.PacketRouter.html">ozpIwc.util.PacketRouter</a></li>
                                <li><a href="../classes/ozpIwc.util.Reference.html">ozpIwc.util.Reference</a></li>
                                <li><a href="../classes/ozpIwc.wiring.html">ozpIwc.wiring</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ozpIwc.html">ozpIwc</a></li>
                                <li><a href="../modules/ozpIwc.api.html">ozpIwc.api</a></li>
                                <li><a href="../modules/ozpIwc.api.base.html">ozpIwc.api.base</a></li>
                                <li><a href="../modules/ozpIwc.api.data.html">ozpIwc.api.data</a></li>
                                <li><a href="../modules/ozpIwc.api.data.node.html">ozpIwc.api.data.node</a></li>
                                <li><a href="../modules/ozpIwc.api.error.html">ozpIwc.api.error</a></li>
                                <li><a href="../modules/ozpIwc.api.filter.html">ozpIwc.api.filter</a></li>
                                <li><a href="../modules/ozpIwc.api.intents.html">ozpIwc.api.intents</a></li>
                                <li><a href="../modules/ozpIwc.api.intents.node.html">ozpIwc.api.intents.node</a></li>
                                <li><a href="../modules/ozpIwc.api.locks.html">ozpIwc.api.locks</a></li>
                                <li><a href="../modules/ozpIwc.api.names.html">ozpIwc.api.names</a></li>
                                <li><a href="../modules/ozpIwc.api.system.html">ozpIwc.api.system</a></li>
                                <li><a href="../modules/ozpIwc.api.system.node.html">ozpIwc.api.system.node</a></li>
                                <li><a href="../modules/ozpIwc.metric.html">ozpIwc.metric</a></li>
                                <li><a href="../modules/ozpIwc.metric.stats.html">ozpIwc.metric.stats</a></li>
                                <li><a href="../modules/ozpIwc.metric.types.html">ozpIwc.metric.types</a></li>
                                <li><a href="../modules/ozpIwc.network.html">ozpIwc.network</a></li>
                                <li><a href="../modules/ozpIwc.packet.html">ozpIwc.packet</a></li>
                                <li><a href="../modules/ozpIwc.policyAuth.html">ozpIwc.policyAuth</a></li>
                                <li><a href="../modules/ozpIwc.policyAuth.elements.html">ozpIwc.policyAuth.elements</a></li>
                                <li><a href="../modules/ozpIwc.policyAuth.points.html">ozpIwc.policyAuth.points</a></li>
                                <li><a href="../modules/ozpIwc.transport.html">ozpIwc.transport</a></li>
                                <li><a href="../modules/ozpIwc.transport.consensus.html">ozpIwc.transport.consensus</a></li>
                                <li><a href="../modules/ozpIwc.transport.listener.html">ozpIwc.transport.listener</a></li>
                                <li><a href="../modules/ozpIwc.transport.participant.html">ozpIwc.transport.participant</a></li>
                                <li><a href="../modules/ozpIwc.util.html">ozpIwc.util</a></li>
                                <li><a href="../modules/ozpIwc.worker.html">ozpIwc.worker</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/js/common/util.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var ozpIwc = ozpIwc || {};

/**
 * @module ozpIwc
 */

/**
 * @class util
 * @namespace ozpIwc
 * @static
 */
ozpIwc.util = (function (util) {

  /**
   * @param  {Object} globalScope
   * @static
   * @return {Object} reference to global scope, works in node,browser,workers.
   */
    util.globalScope = (function(){
      return this;
    })();


    /**
     * Generates a large hexidecimal string to serve as a unique ID.  Not a guid.
     *
     * @method generateId
     * @static
     * @return {String}
     */
    util.generateId = function () {
        return Math.floor(Math.random() * 0xffffffff).toString(16);
    };

    /**
     * Used to get the current epoch time.  Tests overrides this
     * to allow a fast-forward on time-based actions.
     *
     * @method now
     * @return {Number}
     */
    util.now = function () {
        return new Date().getTime();
    };

    /**
     * Applies the template using the supplied object for values
     *
     * @method resolveUriTemplate
     * @param {string} template The template to use
     * @param {Object} obj The object to get template paramters from
     * @param {Object} fallback A secondary object for parameters not contained by the first
     * @return {Number}
     */
    util.resolveUriTemplate = function (template, obj, fallback) {
        var converters = {
            &quot;+&quot;: function (a) { return a;},
            &quot;&quot;: function (a) { return encodeURIComponent(a);}
        };
        var t = template.replace(/\{([\+\#\.\/\;\?\&amp;]?)(.+?)\}/g, function (match, type, name) {
            return converters[type](obj[name] || fallback[name]);
        });
        // look for the :// of the protocol
        var protocolOffset = t.indexOf(&quot;://&quot;);
        // if we found it, set the offset to the end.  otherwise, leave it
        // at -1 so that a leading &quot;//&quot; will be replaced, below
        if (protocolOffset &gt; 0) {
            protocolOffset += 3;
        }

        // remove double // that show up after the protocolOffset
        return t.replace(/\/\//g, function (m, offset) {
            // only swap it after the protocol
            if (offset &gt; protocolOffset) {
                return &quot;/&quot;;
            } else {
                return m;
            }
        });
    };

    /**
     * A record of event listeners used in the given IWC context. Grouped by type.
     *
     * @property eventListeners
     * @static
     * @type {Object}
     */
    util.eventListeners = {};

    /**
     * Adds an event listener to the window and stores its listener in ozpIwc.util.eventListeners.
     *
     * @method addEventListener
     * @param {String} type the event to listen to
     * @param {Function} listener the callback to be used upon the event being emitted
     */
    util.addEventListener = function (type, listener) {
        var l = util.eventListeners[type];
        if (!l) {
            l = util.eventListeners[type] = [];
        }
        l.push(listener);
        util.globalScope.addEventListener(type, listener);
    };

    /**
     * Removes an event listener from the window and from ozpIwc.util.eventListeners
     * @param {String} type the event to remove the listener from
     * @param {Function} listener the callback to unregister
     */
    util.removeEventListener = function (type, listener) {
        var l = util.eventListeners[type];
        if (l) {
            util.eventListeners[type] = l.filter(function (v) { return v !== listener;});
        }
        util.globalScope.removeEventListener(type, listener);
    };

    /**
     * Removes all event listeners registered in ozpIwc.util.eventListeners
     * @param {String} type the event to remove the listener from
     * @param {Function} listener the callback to unregister
     * @param {Boolean} [useCapture] if true all events of the specified type will be dispatched to the registered
     *     listener before being dispatched to any EventTarget beneath it in the DOM tree. Events which are bubbling
     *     upward through the tree will not trigger a listener designated to use capture.
     */
    util.purgeEventListeners = function () {
        ozpIwc.util.object.eachEntry(util.eventListeners, function (type, listenerList) {
            listenerList.forEach(function (listener) {
                util.globalScope.removeEventListener(type, listener);
            });
        });
        util.eventListeners = {};
    };

    /**
     * Create a class with the given parent in it&#x27;s prototype chain.
     *
     * @method extend
     * @param {Function} baseClass The class being derived from.
     * @param {Function} newConstructor The new base class.
     *
     * @return {Function} New Constructor with an augmented prototype.
     */
    util.extend = function (baseClass, newConstructor) {
        if (!baseClass || !baseClass.prototype) {
            ozpIwc.log.error(&quot;Cannot create a new class for &quot;, newConstructor, &quot; due to invalid baseclass:&quot;, baseClass);
            throw new Error(&quot;Cannot create a new class due to invalid baseClass.  Dependency not loaded first?&quot;);
        }
        newConstructor.prototype = Object.create(baseClass.prototype);
        newConstructor.prototype.constructor = newConstructor;
        return newConstructor;
    };

    /**
     * Invoke postMessage on a given window in a safe manner. Test whether the browser
     * supports structured clones, and stringifies the message if not. Catches
     * errors (especially attempts to send non-cloneable objects), and tries to
     * send a stringified copy of the message asa fallback.
     *
     * @param toWindow a window on which to invoke postMessage
     * @param msg the message to be sent
     * @param origin the target origin. The message will be sent only if it matches the origin of window.
     */
    util.safePostMessage = function (toWindow, msg, origin) {
        try {
            var data = msg;
            if (!util.structuredCloneSupport &amp;&amp; typeof data !== &#x27;string&#x27;) {
                data = JSON.stringify(msg);
            }
            toWindow.postMessage(data, origin);
        } catch (e) {
            try {
                toWindow.postMessage(JSON.stringify(msg), origin);
            } catch (e) {
                ozpIwc.log.debug(&quot;Invalid call to postMessage: &quot; + e.message);
            }
        }
    };


    /**
     * Detect browser support for structured clones. Returns quickly since it
     * caches the result. This method only determines browser support for structured
     * clones. Clients are responsible, when accessing capabilities that rely on structured
     * cloning, to ensure that objects to be cloned meet the criteria of the structured clone
     * algorithm. (See ozpIwc.util.safePostMessage for a method which handles attempts to
     * clone an invalid object.). NB: a bug in FF will cause file objects to be treated as
     * non-cloneable, even in FF versions that support structured clones.
     * (see https://bugzilla.mozilla.org/show_bug.cgi?id=722126).
     *
     * @private
     * @property {Boolean} structuredCloneSupport
     */
    util.structuredCloneSupport = (function () {
        var cloneSupport = &#x27;postMessage&#x27; in util.globalScope;
        //If the browser doesn&#x27;t support structured clones, it will call toString() on the object passed to postMessage.
        try {
            util.globalScope.postMessage({
                toString: function () {
                    cloneSupport = false;
                }
            }, &quot;*&quot;);
        } catch (e) {
            //exception expected: objects with methods can&#x27;t be cloned
            //e.DATA_CLONE_ERR will exist only for browsers with structured clone support, which can be used as an
            // additional check if needed
        }
        return cloneSupport;
    }());

    /**
     * Does a deep clone of a serializable object.  Note that this will not
     * clone unserializable objects like DOM elements, Date, RegExp, etc.
     *
     * @method clone
     * @param {Array|Object} value The value to be cloned.
     * @return {Array|Object}  a deep copy of the object
     */
    util.clone = function (value) {
        if (Array.isArray(value) || typeof(value) === &#x27;object&#x27;) {
            try {
                return JSON.parse(JSON.stringify(value));
            } catch (e) {
                ozpIwc.log.error(e);
            }
        } else {
            return value;
        }
    };

    /**
     * A regex method to parse query parameters.
     *
     * @method parseQueryParams
     * @param {String} query
     *
     */
    util.parseQueryParams = function (query) {
        query = query || util.globalScope.location.search;
        var params = {};
        var regex = /\??([^&amp;=]+)=?([^&amp;]*)/g;
        var match;
        while ((match = regex.exec(query)) !== null) {
            params[match[1]] = decodeURIComponent(match[2]);
        }
        return params;
    };

    /**
     * Adds params to the query string of the given url. Accepts objects, preformed query strings, and arrays of query
     * params.
     *
     * @method addQueryParams
     * @param {String} url
     * @param {String|Object|Array} params
     * @return {String}
     */
    util.addQueryParams = function (url, params) {
        if (typeof url !== &quot;string&quot;) {
            throw new Error(&quot;url should be a string.&quot;);
        }

        var formattedParams = {};
        switch (typeof params) {
            case &quot;object&quot;:
                // if in array form [&quot;a=true&quot;,&quot;b=en_us&quot;,...]
                if (Array.isArray(params)) {
                    if (params.length === 0) {
                        return url;
                    }
                    for (var i in params) {
                        if (typeof params[i] === &quot;string&quot;) {
                            var p = util.parseQueryParams(params[i]);
                            for (var j in p) {
                                formattedParams[j] = p[j];
                            }
                        }
                    }
                } else {
                    if (Object.keys(params).length === 0) {
                        return url;
                    }
                    // if in object form {a:true, b:&quot;en_us&quot;,...}
                    formattedParams = params;
                }
                break;
            case &quot;undefined&quot;:
                return url;

            default:
                if (params.length === 0) {
                    return url;
                }
                // if in string form &quot;?a=true&amp;b=en_us&amp;...&quot;
                formattedParams = util.parseQueryParams(params);
                break;
        }
        var hash = &quot;&quot;;
        // Separate the hash temporarily (if exists)
        var hashSplit = url.split(&quot;#&quot;);
        if (hashSplit.length &gt; 2) {
            throw new Error(&quot;Invalid url.&quot;);
        } else {
            url = hashSplit[0];
            hash = hashSplit[1] || &quot;&quot;;
        }

        //if the url has no query params  we append the initial &quot;?&quot;
        if (url.indexOf(&quot;?&quot;) === -1) {
            url += &quot;?&quot;;
        } else {
            url += &quot;&amp;&quot;;
        }
        //skip on first iteration
        var ampersand = &quot;&quot;;
        for (var k in formattedParams) {
            url += ampersand + k + &quot;=&quot; + formattedParams[k];
            ampersand = &quot;&amp;&quot;;
        }

        if (hash.length &gt; 0) {
            url += &quot;#&quot; + hash;
        }

        return url;
    };

    /**
     * A mapping for common protocols and their ports.
     * @property protocolPorts
     * @type {Object}
     */
    util.protocolPorts = {
        &quot;http:&quot;: &quot;80&quot;,
        &quot;https:&quot;: &quot;443&quot;,
        &quot;ws:&quot;: &quot;80&quot;,
        &quot;wss:&quot;: &quot;443&quot;
    };

    /**
     * Determines the origin of a given url.
     * @method determineOrigin
     * @param url
     * @return {String}
     */
    util.determineOrigin = function (url) {
        var a = document.createElement(&quot;a&quot;);
        a.href = url;
        if (a.origin) {
            return a.origin;
        }
        var origin = a.protocol + &quot;//&quot; + a.hostname;
        /* Internet Explorer adds the port to urls in &lt;a&gt; tags created by a script, even
         * if it wasn&#x27;t there to start with.  Thanks, IE!
         * https://connect.microsoft.com/IE/feedback/details/817343/ie11-scripting-value-of-htmlanchorelement-host-differs-between-script-created-link-and-link-from-document
         *
         * Other browsers seem to drop the port if it&#x27;s the default, so we&#x27;ll do the same.
         */

        if (a.port &amp;&amp; util.protocolPorts[a.protocol] !== a.port) {
            origin += &quot;:&quot; + a.port;
        }
        return origin;
    };

    /**
     * Escapes regular expression characters in a string.
     * @method escapeRegex
     * @param {String} str
     * @return {String}
     */
    util.escapeRegex = function (str) {
        return str.replace(/[-\/\\^$*+?.()|[\]{}]/g, &#x27;\\$&amp;&#x27;);
    };

    /**
     *
     * @method parseOzpUrl
     * @param {type} url
     * @return {ozpIwc.packet.Transport}
     */
    util.parseOzpUrl = function (url) {
        var m = /^(?:(?:web\+ozp|ozp):\/\/)?([0-9a-zA-Z](?:[-.\w])*)(\/[^?#]*)(\?[^#]*)?(#.*)?$/.exec(decodeURIComponent(url));
        if (m) {
            // an action of &quot;get&quot; is implied
            var packet = {
                &#x27;dst&#x27;: m[1],
                &#x27;resource&#x27;: m[2],
                &#x27;action&#x27;: &quot;get&quot;
            };
            // TODO: parse the query params into fields

            return packet;
        }
        return null;
    };

    /**
     * Returns true if the specified packet meets the criteria of an IWC Packet.
     * @method isIwcPacket
     * @static
     * @param {ozpIwc.packet.Transport} packet
     * @return {Boolean}
     */
    util.isIWCPacket = function (packet) {
        if (typeof packet.src !== &quot;string&quot; || typeof packet.dst !== &quot;string&quot; ||
            typeof packet.ver !== &quot;number&quot; || typeof packet.msgId !== &quot;string&quot;) {
            return false;
        } else {
            return true;
        }
    };

    /**
     * Returns the version of Internet Explorer or a -1
     * (indicating the use of another browser).
     * @return {number}
     */
    util.getInternetExplorerVersion = function () {
        var rv = -1; // Return value assumes failure.
        var ua, re;
        if (navigator.appName === &#x27;Microsoft Internet Explorer&#x27;) {
            ua = navigator.userAgent;
            re = /MSIE ([0-9]{1,}[\.0-9]{0,})/;
            if (re.exec(ua) !== null) {
                rv = parseFloat(RegExp.$1);
            }
        } else if (navigator.appName === &#x27;Netscape&#x27;) {
            ua = navigator.userAgent;
            re = /Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/;
            if (re.exec(ua) !== null) {
                rv = parseFloat(RegExp.$1);
            }
        }
        return rv;
    };

    /**
     * A promise that resolves when the document is past its prerender state.
     * @method prerender
     * @static
     * @return {Promise}
     */
    util.prerender = function () {
        if (util.runningInWorker) {
            return Promise.resolve();
        }

        return new Promise(function (resolve, reject) {
            if (document === undefined || document.visibilityState === undefined || (document.visibilityState !== &quot;prerender&quot; &amp;&amp;
                document.visibilityState !== &quot;unload&quot;)) {
                resolve();
            } else {
                document.addEventListener(&quot;visibilitychange&quot;, function runOnce(e) {
                    if (document.visibilityState !== &quot;prerender&quot;) {
                        document.removeEventListener(runOnce);
                        resolve();
                    }
                });
            }
        });
    };

    /**
     * A utility to determine if this code is running in a HTML5 Worker. Used to decide on browser technologies
     * to use.
     * @property {Boolean} runningInWorker
     * @static
     */
    util.runningInWorker = (typeof WorkerGlobalScope !== &#x27;undefined&#x27; &amp;&amp;
            this instanceof WorkerGlobalScope);

    /**
     * Wraps window.open.  If the bus is running in a worker, then
     * it doesn&#x27;t have access to the window object and needs help from
     * a participant.
     * @see window.open documentation for what the parameters actually do
     *
     * @method openWindow
     * @static
     * @param {String} url The URL to open in a new window
     * @param {String} windowName The window name to open with.
     * @param {String} [features] The window features.
     */
    util.openWindow = function (url, windowName, features) {
        if (typeof windowName === &quot;object&quot;) {
            var str = &quot;&quot;;
            for (var k in windowName) {
                str += k + &quot;=&quot; + encodeURIComponent(windowName[k]) + &quot;&amp;&quot;;
            }
            windowName = str;
        }
        try {
            util.globalScope.open(url, windowName, features);
        } catch (e) {
            //fallback for IE
            util.globalScope.open(url + &quot;?&quot; + windowName, null, features);
        }
    };

    /**
     * Returns a promise that will resolve after the given delay with any additional arguments passed
     * @param {Number} delay miliseconds to delay
     * @returns {Promise}
     */
    util.promiseDelay = function (delay) {
        return new Promise(function (res) {
            setTimeout(function () { res();}, delay);
        });
    };

    /**
     * Returns the specified default value if the given value is undefined. safer than &quot;x = x || 500&quot; because it checks
     * for being defined, rather than its truly/falsey value.

     * @method ifUndef
     * @static
     * @param {*} value
     * @param {*} defaultVal
     * @return {*}
     */
    util.ifUndef = function (value, defaultVal) {
        return (typeof value === &#x27;undefined&#x27;) ? defaultVal : value;
    };

    /**
     * IE 10 does not play well gathering location.origin.
     * 
     * @method getOrigin
     * @static
     * @return {String} The origin this script is running in
     */
    util.getOrigin = function() {
        if (!location.origin) {
          return location.protocol + &quot;//&quot; + location.hostname + (location.port ? &#x27;:&#x27; + location.port: &#x27;&#x27;);
        }
        return location.origin;
    };
    return util;
}(ozpIwc.util || {}));

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
